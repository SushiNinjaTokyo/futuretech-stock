<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>futuretech-stock ‚Äî Daily Top 10 ({{ date | default('', true) }})</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#ffffff; --fg:#0f172a; --muted:#64748b; --border:#e5e7eb;
      --gold:#f59e0b; --silver:#9ca3af; --bronze:#fb923c;
      --soft:#f8fafc; --ring:#e2e8f0;
      --up:#065f46; --upbg:#ecfdf5; --upbd:#10b98133;
      --dn:#7f1d1d; --dnbg:#fef2f2; --dbd:#ef444433;
      --nz:#6b7280; --nzbg:#f3f4f6; --nzbd:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--fg)}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    header{margin-bottom:16px}
    h1{font-size:22px;margin:0 0 6px;letter-spacing:-0.2px}
    .sub{color:var(--muted);font-size:12px}

    .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:12px}
    @media (min-width:900px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}

    .card{position:relative;border:1px solid var(--border);border-radius:16px;padding:14px;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .sym{display:flex;align-items:center;gap:12px;min-width:0}

    .symbol{font-size:18px;font-weight:800;letter-spacing:.2px}
    .name{font-size:12px;color:var(--muted)}

    .score{text-align:right;display:flex;flex-direction:column;align-items:flex-end;line-height:1.05}
    .score .num{
      font-size:28px;font-weight:900;letter-spacing:-.4px;
      padding:6px 10px;border-radius:12px;border:1px solid var(--ring);
      background:linear-gradient(180deg,#ffffff 0%,#f9fafb 100%);
    }
    .score.top1 .num{ border-color:#f59e0b66; box-shadow:0 0 0 4px #f59e0b26; }
    .score.top2 .num{ border-color:#9ca3af66; box-shadow:0 0 0 4px #9ca3af26; }
    .score.top3 .num{ border-color:#fb923c66; box-shadow:0 0 0 4px #fb923c26; }
    .score .den{font-size:11px;color:var(--muted);margin-top:2px}

    /* === corner tab badge (Top 1/2/3) === */
    .corner-tab{
      position:absolute; top:0; right:14px; transform:translateY(-45%);
      display:flex; align-items:center; gap:8px;
      background:#fff; border:1px solid var(--border);
      border-radius:999px; padding:6px 12px; font-size:12px; font-weight:700;
      box-shadow:0 6px 16px rgba(0,0,0,.06);
      z-index:3;
    }
    .corner-tab:after{
      content:""; position:absolute; right:12px; bottom:-7px; width:12px; height:12px;
      background:#fff; border-left:1px solid var(--border); border-bottom:1px solid var(--border);
      transform:rotate(45deg);
    }
    .corner-dot{width:8px;height:8px;border-radius:999px}
    .corner-tab.top1 .corner-dot{background:var(--gold)}
    .corner-tab.top2 .corner-dot{background:#52525b}
    .corner-tab.top3 .corner-dot{background:var(--bronze)}

    /* medals (News/Trends top3) */
    .medals{display:flex;gap:6px;margin:8px 0 6px;flex-wrap:wrap}
    .medal{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:3px 8px;line-height:1}
    .medal .label{font-size:11px;letter-spacing:.2px}
    .medal .kind{font-size:11px;color:#111;text-transform:capitalize}
    .medal.gold{border-color:#f59e0b44;box-shadow:0 0 0 2px #f59e0b1f inset}
    .medal.silver{border-color:#9ca3af44;box-shadow:0 0 0 2px #9ca3af1f inset}
    .medal.bronze{border-color:#fb923c44;box-shadow:0 0 0 2px #fb923c1f inset}
    .medal .emoji{font-size:14px}

    /* price chips ‚Äî single row, no wrap */
    .price-chips{display:flex;flex-wrap:nowrap;gap:8px;margin-top:6px;overflow-x:auto;scrollbar-width:none}
    .price-chips::-webkit-scrollbar{display:none}
    .pch{white-space:nowrap;font-size:12px;border:1px solid var(--nzbd);background:var(--nzbg);color:var(--nz);padding:6px 10px;border-radius:999px;line-height:1}
    .pch .k{color:var(--muted);margin-right:6px}
    .pch.up{border-color:var(--upbd);background:var(--upbg);color:var(--up)}
    .pch.down{border-color:var(--dbd);background:var(--dnbg);color:var(--dn)}
    .pch.neutral{border-color:var(--nzbd);background:var(--nzbg);color:var(--nz)}

    /* segmented tabs */
    .tabs{margin-top:12px}
    .seg{display:inline-flex;gap:0;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:rgba(243,244,246,.6);backdrop-filter:saturate(1.1) blur(2px)}
    .seg .segbtn{
      appearance:none;border:0;margin:0;padding:10px 14px;background:transparent;cursor:pointer;
      font-size:13px;color:#111;line-height:1;display:flex;align-items:center;gap:8px;
    }
    .seg .segbtn:focus{outline:none;box-shadow:inset 0 0 0 2px rgba(0,0,0,.08)}
    .seg .segbtn[aria-pressed="true"]{
      background:#fff; font-weight:700;
      box-shadow:inset 0 0 0 1px var(--border);
    }
    .seg .ico{font-size:16px;opacity:.9}
    .tab{display:none}
    .tab.active{display:block}

    .chart{width:100%;border:1px solid var(--border);border-radius:10px}

    .table{width:100%;border-collapse:collapse;margin-top:6px}
    .table th,.table td{border-bottom:1px solid var(--border);padding:6px 8px;font-size:12px;text-align:left}
    .table th{color:var(--muted);font-weight:600}
    .right{text-align:right}
    .muted{color:var(--muted)}
    details{margin-top:6px;background:#fafafa;border:1px solid var(--border);border-radius:8px;padding:8px 10px}
    details>summary{cursor:pointer;font-size:12px;color:#111;user-select:none}
    .kv{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:8px}
    .kv div{font-size:12px;background:#fff;border:1px solid var(--border);border-radius:8px;padding:6px 8px}
    .kv .k{color:var(--muted)}

    /* ===== Rocket rank badges (always perfect circle) ===== */
    .rank-rocket{
      width:clamp(52px,14vw,68px);
      aspect-ratio:1/1;           /* ÁúüÂÜÜ„ÇíÂº∑Âà∂ */
      border-radius:50%;
      display:grid; place-items:center;
      position:relative; isolation:isolate;
      box-shadow:inset 0 8px 22px rgba(0,0,0,.08), 0 6px 14px rgba(0,0,0,.06);
      border:2px solid #fff;
      overflow:hidden;
      flex:0 0 auto;             /* Ê®™ÂπÖÁ∂≠ÊåÅÔºà„Çπ„Éû„Éõ„ÅßÊΩ∞„Çå„Å™„ÅÑÔºâ */
    }
    .rank-rocket .num{
      position:absolute; right:-6px; bottom:-6px;
      width:22px; height:22px; border-radius:999px;
      background:#0f172a; color:#fff; font-weight:800; font-size:11px;
      display:flex; align-items:center; justify-content:center;
      border:2px solid #fff; z-index:2;
    }
    .rank-rocket svg{ width:58%; height:auto; filter:drop-shadow(0 2px 4px rgba(0,0,0,.2)); z-index:2; }
    .rank-rocket .flame{ transform-origin:10px 18px; }

    /* 1/2/3 ‰Ωç„ÅÆËÉåÊôØÔºàÊòéÁ¢∫„Å™Â∑ÆÔºâ */
    .rank1{ background:
        radial-gradient(130px 130px at 30% 20%, #fff2 0%, #0000 62%),
        linear-gradient(135deg,#f59e0b 0%,#f97316 55%,#fdba74 120%);
      box-shadow:0 0 0 3px #fef3c7, 0 10px 28px rgba(245,158,11,.38); }
    .rank2{ background:
        radial-gradient(130px 130px at 30% 20%, #fff2 0%, #0000 62%),
        linear-gradient(135deg,#cbd5e1 0%,#9ca3af 60%,#6b7280 120%);
      box-shadow:0 0 0 3px #e5e7eb, 0 10px 28px rgba(107,114,128,.28); }
    .rank3{ background:
        radial-gradient(130px 130px at 30% 20%, #fff2 0%, #0000 62%),
        linear-gradient(135deg,#fb923c 0%,#f59e0b 60%,#fde68a 120%);
      box-shadow:0 0 0 3px #fee2e2, 0 10px 28px rgba(251,146,60,.3); }
    .rankN{ background:#f3f4f6; box-shadow:inset 0 6px 18px rgba(0,0,0,.06); }

    /* Rocket animation
       - rank1: ignitionÔºàÂº∑Êé®ÂäõÔºã„Çπ„É¢„Éº„ÇØÔºã„Éê„Ç¶„É≥„ÇπÔºâ
       - rank2: gentle lift
       - rank3: pre-ignitionÔºàÂæÆÊåØÂãïÔºâ */
    .rank1::before{
      content:""; position:absolute; bottom:-6px; left:50%; transform:translateX(-50%);
      width:70%; height:40%; border-radius:50%;
      background:radial-gradient(closest-side, rgba(255,255,255,.9), rgba(255,255,255,.0));
      filter:blur(6px); z-index:1; animation:smoke 1.2s ease-in-out infinite;
    }
    @keyframes smoke{
      0%{ transform:translateX(-50%) scale(1); opacity:.85; }
      60%{ transform:translateX(-50%) scale(1.08); opacity:.45; }
      100%{ transform:translateX(-50%) scale(1); opacity:.85; }
    }
    .rank1 .rocket{ animation:ignite 1.4s cubic-bezier(.22,.61,.36,1) infinite; }
    .rank1 .flame { animation:flameStrong .7s ease-in-out infinite; filter:drop-shadow(0 0 6px rgba(249,115,22,.7)); }
    .rank2 .rocket{ animation:lift 1.8s ease-in-out infinite; }
    .rank2 .flame { animation:flicker .9s ease-in-out infinite; opacity:.9; }
    .rank3 .rocket{ animation:wobble 1.8s ease-in-out infinite; opacity:.96; }
    .rank3 .flame { animation:prime .9s ease-in-out infinite; opacity:.55; }

    @keyframes ignite{
      0%{ transform:translateY(0) rotate(-6deg); }
      35%{ transform:translateY(-6px) rotate(-2deg); }
      70%{ transform:translateY(-10px) rotate(0deg); }
      100%{ transform:translateY(0) rotate(-6deg); }
    }
    @keyframes flameStrong{
      0%,100%{ opacity:1; transform:scale(1) translateY(0); }
      50%{ opacity:.55; transform:scale(1.15) translateY(1px); }
    }
    @keyframes lift{
      0%{ transform:translateY(0) rotate(-4deg); }
      50%{ transform:translateY(-3px) rotate(0deg); }
      100%{ transform:translateY(0) rotate(-4deg); }
    }
    @keyframes flicker{
      0%,100%{ opacity:.95; transform:scale(1); }
      50%{ opacity:.55; transform:scale(.85); }
    }
    @keyframes wobble{
      0%,100%{ transform:translateY(0) rotate(-2deg); }
      50%{ transform:translateY(-1px) rotate(-1deg); }
    }
    @keyframes prime{
      0%,100%{ opacity:.5; transform:scale(.92); }
      50%{ opacity:.8; transform:scale(1.0); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>futuretech-stock ‚Äî Daily Top 10</h1>
      <div class="sub">Date: {{ date | default('', true) }} / Scoring: 1000 ptsÔºàvolume + insider + trends + newsÔºâ</div>
    </header>

    {% if top10 is defined %}
    <div class="grid" id="cards">
      {% for item in top10 %}
        {% set _sym  = item.symbol | default('', true) %}
        {% set _name = item.name   | default('', true) %}
        {% set rank = (item.rank | default(loop.index, true)) %}
        {% set chart_url = (item.chart_url | default('/charts/' ~ (date | default('', true)) ~ '/' ~ _sym ~ '.png', true)) %}
        {% set pts = item.score_pts | default((item.final_score_0_1|default(0,true) * 1000) | round(0, 'common'), true) %}
        {% set vol = (item.detail.vol_anomaly if (item.detail is defined and item.detail and item.detail.vol_anomaly is defined) else none) %}

        <div class="card {% if rank<=3 %}is-top{% endif %}" id="card-{{ loop.index }}" data-symbol="{{ _sym }}">
          {% if rank<=3 %}
          <div class="corner-tab top{{rank}}">
            <span class="corner-dot"></span> Top {{rank}}
          </div>
          {% endif %}

          <div class="row">
            <div class="sym">
              {% set rank_class = 'rank1' if rank==1 else ('rank2' if rank==2 else ('rank3' if rank==3 else 'rankN') ) %}
              <div class="rank-rocket {{ rank_class }}" aria-label="Rank {{ rank }}">
                <svg class="rocket" viewBox="0 0 24 24" role="img" aria-hidden="true">
                  <path d="M12 3c3 0 6 3.2 6 6.8 0 1.4-.4 2.8-1.1 4l-2.4 4c-.3.6-.9 1-1.6 1h-2.8c-.7 0-1.3-.4-1.6-1l-2.4-4A8.2 8.2 0 0 1 6 9.8C6 6.2 9 3 12 3Z" fill="#ffffff"/>
                  <circle cx="12" cy="9.5" r="2.2" fill="#94a3b8"/>
                  <path d="M7.8 13.5l2.1 3.5H7.6a1 1 0 0 1-.9-1.4l1.1-2.1z" fill="#cbd5e1"/>
                  <path d="M16.2 13.5l-2.1 3.5h2.3c.8 0 1.3-.9.9-1.6l-1.1-1.9z" fill="#cbd5e1"/>
                  <path class="flame" d="M11.2 20.5c-.8-1.2.6-2.4.8-2.9.2.5 1.6 1.7.8 2.9-.5.8-1.9.8-2.4 0z" fill="#f97316"/>
                </svg>
                <div class="num">{{ rank }}</div>
              </div>

              <div style="min-width:0">
                <div class="symbol">{{ _sym }}</div>
                {% if _name %}<div class="name">{{ _name }}</div>{% endif %}
                <div class="price-chips" aria-label="Price changes (1D/1W/1M)"></div>
              </div>
            </div>

            <div class="score {% if rank==1 %}top1{% elif rank==2 %}top2{% elif rank==3 %}top3{% endif %}">
              <div class="num">{{ pts | int }}</div>
              <div class="den">/ 1000</div>
            </div>
          </div>

          <div class="medals"></div>

          <div class="tabs">
            <div class="seg" role="tablist" aria-label="Card sections">
              <button class="segbtn" role="tab" aria-selected="false" aria-pressed="false"
                      data-target="#ov-{{ loop.index }}"><span class="ico">üß≠</span>Overview</button>
              <button class="segbtn" role="tab" aria-selected="false" aria-pressed="false"
                      data-target="#tech-{{ loop.index }}"><span class="ico">üìà</span>Weekly chart</button>
            </div>

            <div id="ov-{{ loop.index }}" class="tab" role="tabpanel" aria-hidden="true">
              <table class="table js-breakdown">
                <thead>
                  <tr>
                    <th>Component</th>
                    <th class="right">Normalized</th>
                    <th class="right">Weight</th>
                    <th class="right">Contribution (pts)</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr>
                    <th colspan="3" class="right">Total</th>
                    <th class="right"><span class="js-total">{{ pts | int }}</span></th>
                  </tr>
                </tfoot>
              </table>

              <details>
                <summary>Volume anomaly details</summary>
                {% if vol %}
                  {% set rvol20 = vol.get('rvol20') %}
                  {% set z60 = vol.get('z60') %}
                  {% set pr90 = vol.get('pct_rank_90') %}
                  {% set dv = vol.get('dollar_vol') %}
                  {% set eligible = vol.get('eligible') %}
                  <div class="kv">
                    <div><span class="k">RVOL20</span><br>{{ rvol20 is not none and "%.2f"|format(rvol20) or "-" }}</div>
                    <div><span class="k">Z60</span><br>{{ z60 is not none and "%.2f"|format(z60) or "-" }}</div>
                    <div><span class="k">PctRank90</span><br>{{ pr90 is not none and "%.2f"|format(pr90) or "-" }}</div>
                    <div><span class="k">DollarVol</span><br>{% if dv is not none %}${{ "%.1f"|format(dv/1_000_000) }}M{% else %}-{% endif %}</div>
                    <div><span class="k">Eligible</span><br>{{ eligible and "Yes" or "No" }}</div>
                  </div>
                {% else %}
                  <div class="muted">No details.</div>
                {% endif %}
              </details>

              <details class="js-insider">
                <summary>Insider details (Form 4)</summary>
                <div class="muted">Loading‚Ä¶</div>
              </details>
            </div>

            <div id="tech-{{ loop.index }}" class="tab" role="tabpanel" aria-hidden="true">
              <img src="{{ chart_url }}" alt="{{ _sym }} weekly chart" class="chart" loading="lazy" />
            </div>
          </div>

          <!-- JSON payload -->
          <script type="application/json" class="js-payload">
          {{ {
            "symbol": _sym,
            "score_components": (item.score_components if item.score_components is defined else {}),
            "score_weights": (item.score_weights if item.score_weights is defined else {}),
            "final_score_0_1": item.final_score_0_1 | default(0, true),
            "score_pts": pts | int,
            "insider_momo": item.insider_momo | default(0, true),
            "trends_breakout": item.trends_breakout | default(0, true),
            "vol_anomaly_score": item.vol_anomaly_score | default(0, true),
            "news_score": item.news_score | default(0, true),
            "news_recent_count": item.news_recent_count | default(0, true),
            "price_change": (item.price_change if item.price_change is defined else {})
          } | tojson }}
          </script>
        </div>
      {% endfor %}
    </div>
    {% else %}
      <div id="cards" class="grid"></div>
    {% endif %}
  </div>

  <script>
    // Segmented toggle: closed by default
    function bindToggles(scope=document){
      scope.querySelectorAll(".card").forEach(card=>{
        const seg=card.querySelector(".seg"); if(!seg) return;
        const buttons=[...seg.querySelectorAll(".segbtn")];
        const panels=[...card.querySelectorAll(".tab")];
        function togglePanel(btn){
          const sel=btn.getAttribute("data-target");
          const panel=card.querySelector(sel);
          const isActive=panel.classList.contains("active");
          if(isActive){
            btn.setAttribute("aria-pressed","false"); btn.setAttribute("aria-selected","false");
            panel.classList.remove("active"); panel.setAttribute("aria-hidden","true"); return;
          }
          buttons.forEach(b=>{b.setAttribute("aria-pressed","false");b.setAttribute("aria-selected","false");});
          panels.forEach(p=>{p.classList.remove("active");p.setAttribute("aria-hidden","true");});
          btn.setAttribute("aria-pressed","true"); btn.setAttribute("aria-selected","true");
          panel.classList.add("active"); panel.setAttribute("aria-hidden","false");
        }
        buttons.forEach(btn=>{
          btn.addEventListener("click",()=>togglePanel(btn));
          btn.addEventListener("keydown",(e)=>{ if(e.key==="Enter"||e.key===" "){e.preventDefault();togglePanel(btn);} });
        });
      });
    }

    // Breakdown
    function fillBreakdown(){
      document.querySelectorAll(".card").forEach(card=>{
        const payloadEl=card.querySelector(".js-payload"); if(!payloadEl) return;
        let data={}; try{ data=JSON.parse(payloadEl.textContent||"{}"); }catch(_){}
        const comps=data.score_components||{}; const weights=data.score_weights||{};
        const keys=Object.keys(comps).filter(k=>comps[k]!=null);
        const wsum=keys.reduce((s,k)=>s+Math.max(0,Number(weights[k]||0)),0)||1;
        const tbody=card.querySelector(".js-breakdown tbody"); const totalEl=card.querySelector(".js-total");
        if(!tbody) return; tbody.innerHTML=""; let totalPts=0;
        const label=k=>({volume_anomaly:"Volume anomaly",insider_momo:"Insider momentum",trends_breakout:"Trends breakout",news:"News coverage"}[k]||k);
        keys.forEach(k=>{
          const v=Math.max(0,Math.min(1,Number(comps[k]||0)));
          const wn=Math.max(0,Number(weights[k]||0))/wsum;
          const pts=Math.round(v*wn*1000); totalPts+=pts;
          const tr=document.createElement("tr");
          tr.innerHTML=`<td>${label(k)}</td><td class="right">${v.toFixed(2)}</td><td class="right">${(wn*100).toFixed(0)}%</td><td class="right">${pts}</td>`;
          tbody.appendChild(tr);
        });
        if(totalEl) totalEl.textContent=String(totalPts);
      });
    }

    // Insider details
    async function fillInsiderDetails(){
      try{
        const res=await fetch(`/data/insider/form4_latest.json`,{cache:"no-store"});
        if(!res.ok) throw new Error("fetch insider json failed");
        const j=await res.json(); const items=j.items||{};
        document.querySelectorAll(".card").forEach(card=>{
          const sym=card.getAttribute("data-symbol");
          const box=card.querySelector(".js-insider"); if(!box) return;
          const rec=items[sym];
          if(!rec){ box.innerHTML=`<summary>Insider details (Form 4)</summary><div class="muted">No data</div>`; return; }
          box.innerHTML=`<summary>Insider details (Form 4)</summary>
            <div class="kv">
              <div><span class="k">Net buy (30d)</span><br>${(rec.net_buy_shares_30||0).toLocaleString()} shares</div>
              <div><span class="k">Net buy (90d)</span><br>${(rec.net_buy_shares_90||0).toLocaleString()} shares</div>
              <div><span class="k">Unique buyers (30d)</span><br>${(rec.buyers_30||0)}</div>
              <div><span class="k">Unique buyers (90d)</span><br>${(rec.buyers_90||0)}</div>
              <div><span class="k">Score 30</span><br>${Number(rec.score_30||0).toFixed(2)}</div>
              <div><span class="k">Score 90</span><br>${Number(rec.score_90||0).toFixed(2)}</div>
            </div>`;
        });
      }catch(e){
        document.querySelectorAll(".js-insider").forEach(box=>{
          box.innerHTML=`<summary>Insider details (Form 4)</summary><div class="muted">Failed to load</div>`;
        });
      }
    }

    // Price chips (1D/1W/1M) single row
    function fillPriceChips(){
      document.querySelectorAll(".card").forEach(card=>{
        const payloadEl=card.querySelector(".js-payload"); if(!payloadEl) return;
        let data={}; try{ data=JSON.parse(payloadEl.textContent||"{}"); }catch(_){}
        const pc=(data.price_change)||{}; const mount=card.querySelector(".price-chips"); if(!mount) return;
        const fmt=(v)=>{
          if(v===null || v===undefined || isNaN(Number(v))) return {cls:"neutral", text:"‚Äî"};
          const n=Number(v);
          return n>0?{cls:"up", text:`+${n.toFixed(2)}%`}: (n<0?{cls:"down", text:`${n.toFixed(2)}%`}:{cls:"neutral", text:`${n.toFixed(2)}%`});
        };
        const d1=fmt(pc.d1), w1=fmt(pc.w1), m1=fmt(pc.m1);
        mount.innerHTML=`
          <span class="pch ${d1.cls}"><span class="k">1D</span>${d1.text}</span>
          <span class="pch ${w1.cls}"><span class="k">1W</span>${w1.text}</span>
          <span class="pch ${m1.cls}"><span class="k">1M</span>${m1.text}</span>
        `;
      });
    }

    // Medals Top3 for Trends/News
    function decorateTop3Medals(){
      const cards=[...document.querySelectorAll(".card")].map(card=>{
        let data={}; try{ data=JSON.parse(card.querySelector(".js-payload")?.textContent||"{}"); }catch(_){}
        return { card, symbol:card.getAttribute("data-symbol"),
                 trends:Number(data.trends_breakout||0), news:Number(data.news_score||0) };
      });
      const rankBy=(arr,key)=>[...arr].sort((a,b)=>Number(b[key])-Number(a[key]))
        .map((o,i)=>({...o,_rank:i+1})).filter(o=>o[key]>0 && o._rank<=3);
      const tMap=new Map(rankBy(cards,"trends").map(o=>[o.symbol,o._rank]));
      const nMap=new Map(rankBy(cards,"news").map(o=>[o.symbol,o._rank]));
      const medalInfo=r=>r===1?{cls:"gold",emoji:"ü•á"}:r===2?{cls:"silver",emoji:"ü•à"}:{cls:"bronze",emoji:"ü•â"};
      cards.forEach(({card,symbol})=>{
        const box=card.querySelector(".medals"); if(!box) return; box.innerHTML="";
        const t=tMap.get(symbol); if(t){ const m=medalInfo(t); const el=document.createElement("span");
          el.className=`medal ${m.cls}`; el.title=`Trends Top #${t}`;
          el.innerHTML=`<span class="emoji">${m.emoji}</span><span class="label"><span class="kind">Trends</span></span>`;
          box.appendChild(el);
        }
        const n=nMap.get(symbol); if(n){ const m=medalInfo(n); const el=document.createElement("span");
          el.className=`medal ${m.cls}`; el.title=`News Top #${n}`;
          el.innerHTML=`<span class="emoji">${m.emoji}</span><span class="label"><span class="kind">News</span></span>`;
          box.appendChild(el);
        }
      });
    }

    // INIT
    bindToggles();        // Overview „ÅØ„Éá„Éï„Ç©„É´„ÉàÈñâ
    fillBreakdown();
    fillInsiderDetails();
    fillPriceChips();     // Ê®™‰∏ÄÂàó„ÅßË°®Á§∫
    decorateTop3Medals();
  </script>
</body>
</html>
